# راهنمای فرم‌های مبتنی بر تصویر

## 📋 خلاصه

این قابلیت جدید به سیستم Flask شما امکان ایجاد فرم‌های مبتنی بر تصویر را می‌دهد. مدیران می‌توانند به جای استفاده از Google Docs، تصاویر (JPG/PNG) آپلود کرده و روی آن‌ها فرم طراحی کنند.

## ✨ ویژگی‌های جدید

### 1. انتخاب نوع فرم
- **Google Docs**: همان روش قبلی
- **تصویر (JPG/PNG)**: روش جدید مبتنی بر تصویر

### 2. طراحی فرم روی تصویر
- آپلود تصویر با پشتیبانی از فرمت‌های JPG و PNG
- انتخاب اندازه صفحه (A4، A5، یا اندازه اصلی تصویر)
- طراحی تکست‌باکس‌ها روی تصویر با HTML5 Canvas
- تنظیم فونت، اندازه و رنگ متن
- اتصال تکست‌باکس‌ها به فیلدهای فرم

### 3. تولید PDF
- تولید PDF با کیفیت بالا از تصویر + متن‌های کاربر
- پشتیبانی از فونت‌های فارسی
- تنظیم اندازه صفحه

## 🚀 نصب و راه‌اندازی

### 1. نصب وابستگی‌ها
```bash
pip install -r requirements.txt
```

### 2. اجرای مایگریشن
```bash
python migrate_image_forms.py
```

### 3. تست عملکرد
```bash
python test_image_forms.py
```

## 📖 نحوه استفاده

### مرحله 1: ایجاد خدمت جدید
1. به بخش "ایجاد خدمت جدید" بروید
2. نوع فرم را "تصویر (JPG/PNG)" انتخاب کنید
3. تصویر مورد نظر را آپلود کنید
4. اندازه صفحه را انتخاب کنید
5. خدمت را ایجاد کنید

### مرحله 2: طراحی فرم
1. روی دکمه "طراحی" کلیک کنید
2. در صفحه طراحی:
   - روی تصویر کلیک و بکشید تا تکست‌باکس ایجاد شود
   - تکست‌باکس را انتخاب کنید
   - در پنل سمت راست تنظیمات را تغییر دهید:
     - متن نمایشی
     - اتصال به فیلد
     - فونت و اندازه
     - رنگ
     - موقعیت و اندازه
3. طراحی را ذخیره کنید

### مرحله 3: تعریف فیلدها
1. روی دکمه "فیلدها" کلیک کنید
2. برای هر تکست‌باکس، فیلد مربوطه را تعریف کنید:
   - برچسب فیلد
   - نام فیلد (انگلیسی)
   - نوع فیلد
   - اجباری بودن
   - متن راهنما
   - جایگزین در طراحی

### مرحله 4: تست و استفاده
1. خدمت آماده استفاده است
2. کاربران می‌توانند فرم را پر کنند
3. PDF با متن‌های کاربر روی تصویر تولید می‌شود

## 🛠️ ساختار فایل‌ها

### فایل‌های جدید
- `image_pdf_generator.py`: تولید PDF از تصویر
- `migrate_image_forms.py`: مایگریشن دیتابیس
- `test_image_forms.py`: تست عملکرد
- `templates/admin/design_image_form.html`: صفحه طراحی فرم
- `templates/admin/edit_image_form_fields.html`: صفحه تعریف فیلدها

### فایل‌های تغییر یافته
- `models.py`: اضافه شدن فیلدهای جدید به مدل Service
- `forms.py`: اضافه شدن فرم‌های جدید
- `app.py`: اضافه شدن route های جدید
- `templates/admin/create_service.html`: پشتیبانی از انتخاب نوع فرم
- `templates/admin/dashboard.html`: نمایش نوع فرم

## 📊 ساختار دیتابیس

### جدول services - فیلدهای جدید
```sql
ALTER TABLE services ADD COLUMN form_type VARCHAR(20) DEFAULT 'google_doc';
ALTER TABLE services ADD COLUMN image_path VARCHAR(500);
ALTER TABLE services ADD COLUMN form_design_data TEXT;
ALTER TABLE services ADD COLUMN page_size VARCHAR(10) DEFAULT 'A4';
```

### توضیح فیلدها
- `form_type`: نوع فرم ('google_doc' یا 'image')
- `image_path`: مسیر فایل تصویر آپلود شده
- `form_design_data`: داده‌های طراحی فرم (JSON)
- `page_size`: اندازه صفحه ('A4', 'A5', 'original')

## 🎨 فرمت داده‌های طراحی

```json
{
  "textboxes": [
    {
      "id": 1,
      "x": 100,
      "y": 100,
      "width": 200,
      "height": 30,
      "label": "نام و نام خانوادگی",
      "field": "name",
      "font": "Arial",
      "size": 14,
      "color": "#000000"
    }
  ],
  "canvasWidth": 800,
  "canvasHeight": 600,
  "pageSize": "A4"
}
```

## 🔧 تنظیمات پیشرفته

### فونت‌های پشتیبانی شده
- Arial
- Times New Roman
- Courier New
- Tahoma
- B Nazanin
- B Titr
- Vazirmatn

### اندازه‌های صفحه
- A4 (595 × 842 points)
- A5 (420 × 595 points)
- Original (اندازه اصلی تصویر)

## 🧪 تست

### اجرای تست‌ها
```bash
python test_image_forms.py
```

### تست‌های موجود
1. **تست تولید PDF**: بررسی تولید PDF از تصویر
2. **تست مدل دیتابیس**: بررسی ذخیره و بازیابی داده‌ها
3. **تست ایجاد فرم**: بررسی ایجاد کامل فرم

## 🐛 عیب‌یابی

### مشکلات رایج

#### 1. خطا در آپلود تصویر
- بررسی مجوزهای پوشه `static/uploads/images`
- بررسی اندازه فایل (حداکثر 10MB)
- بررسی فرمت فایل (فقط JPG/PNG)

#### 2. خطا در تولید PDF
- بررسی نصب Pillow: `pip install Pillow`
- بررسی وجود فونت‌ها در پوشه `fonts`
- بررسی مجوزهای پوشه خروجی PDF

#### 3. خطا در طراحی فرم
- بررسی نصب JavaScript در مرورگر
- بررسی اتصال اینترنت برای بارگذاری تصویر
- پاک کردن کش مرورگر

### لاگ‌ها
لاگ‌های سیستم در فایل‌های زیر قابل مشاهده است:
- خطاهای PDF: `app.logger.error()`
- خطاهای آپلود: `app.logger.warning()`
- اطلاعات عمومی: `app.logger.info()`

## 🔄 مایگریشن از نسخه قبلی

### مرحله 1: پشتیبان‌گیری
```bash
# پشتیبان‌گیری از دیتابیس
sqlite3 app.db ".backup backup_before_migration.db"
```

### مرحله 2: اجرای مایگریشن
```bash
python migrate_image_forms.py
```

### مرحله 3: بررسی
```bash
python test_image_forms.py
```

## 📈 عملکرد

### بهینه‌سازی‌ها
- استفاده از PIL برای پردازش تصویر
- کش کردن فونت‌ها
- فشرده‌سازی تصاویر
- تولید PDF بهینه

### محدودیت‌ها
- حداکثر اندازه فایل: 10MB
- فرمت‌های پشتیبانی شده: JPG, PNG
- حداکثر تعداد تکست‌باکس: نامحدود (توصیه: کمتر از 50)

## 🔮 توسعه‌های آینده

### قابلیت‌های پیشنهادی
- پشتیبانی از فرمت‌های تصویری بیشتر (GIF, BMP)
- ابزارهای طراحی پیشرفته (خط، شکل، تصویر)
- قالب‌های آماده
- ویرایشگر WYSIWYG
- پشتیبانی از چندین صفحه

### API های جدید
- `/api/design/save`: ذخیره طراحی
- `/api/design/load`: بارگذاری طراحی
- `/api/image/upload`: آپلود تصویر
- `/api/pdf/generate`: تولید PDF

## 📞 پشتیبانی

برای گزارش مشکلات یا درخواست ویژگی‌های جدید:
1. بررسی بخش عیب‌یابی
2. اجرای تست‌ها
3. بررسی لاگ‌های سیستم
4. تماس با تیم توسعه

---

**نکته**: این قابلیت با سیستم موجود کاملاً سازگار است و تأثیری بر عملکرد Google Docs ندارد.